# szkub

Bitrix-проект: код в Git, локальная разработка в Docker (env-docker), прод обновляется из GitHub.

## Структура
- `docs/` — исходная верстка
- `local/templates/szcube/` — шаблон Bitrix (css/js/img/fonts + header/footer)
- `index.php` — главная
- `consulting/` — страница консалтинга

## Примечания
- Бандла нет, все скрипты — отдельные файлы.

## Локальная разработка (env-docker)
env-docker лежит рядом: `/home/sxtim/dev/env-docker`, сайт доступен на `http://127.0.0.1:8588/`.

Запуск/остановка:
```bash
cd /home/sxtim/dev/env-docker
docker compose up -d        # старт
docker compose stop         # стоп
docker compose down         # стоп + удалить контейнеры (тома не трогает)
docker compose logs -f nginx php
```

Восстановление из бэкапа делай без override (чтобы случайно не перетереть код из Git):
```bash
cd /home/sxtim/dev/env-docker
docker compose -f docker-compose.yml up -d
```
Дальше открывай `http://127.0.0.1:8588/restore.php` и восстанавливай архив.

### Новые страницы/папки в корне сайта
Сейчас в `docker-compose.override.yml` прокинуты не весь репозиторий, а только выбранные пути (`local/`, `apartments/`, `consulting/`, `tenders/`, `index.php`).

Если создал новую папку в корне сайта (например `newpage/`) и хочешь видеть её в локалке — добавь её в `/home/sxtim/dev/env-docker/docker-compose.override.yml` в секции `php.volumes` и `nginx.volumes`:
```yml
- ../szkub/newpage:/opt/www/newpage
```
И примени:
```bash
cd /home/sxtim/dev/env-docker
docker compose up -d
```

## Прод: деплой из Git
Прод обновляется без merge (предсказуемо) — трогаются только tracked файлы.

```bash
cd /home/c/cf144342/bitrix_d7dca/public_html
git fetch origin --prune
git reset --hard origin/main
git diff --name-status HEAD..origin/main - посмотреть, что изменится
```

Откат:
```bash
git reset --hard <commit>
```

## Флоу разработки фичи (акции/новости)
Цель: сначала быстро верстаем (PHP-статика), потом “натягиваем” на админку (инфоблоки/компоненты) без переделки верстки.

Текущая структура страниц (статика):
- `/news/` — список новостей (`news/index.php`)
- `/news/<code>/` — детальная (`news/detail.php`, код приходит через `urlrewrite.php`)
- `/promotions/` — список акций (`promotions/index.php`)
- `/promotions/<code>/` — детальная (`promotions/detail.php`)
- фильтр акций по ЖК: `/promotions/?zhk=kollekciya` (акции без ЖК в фильтре не показываем)

Рабочие шаги в этой ветке:
1) Создаём PHP-скелеты страниц (без дизайна/админки).
2) Вставляем верстку по блокам прямо в эти страницы (пока статично).
3) Когда верстка “устаканится” — переносим данные в админку и заменяем статические массивы на инфоблоки/компоненты (верстку не ломаем).

Локалка (env-docker): чтобы видеть новые папки `news/` и `promotions/`, добавь их в `/home/sxtim/dev/env-docker/docker-compose.override.yml` (и в `php.volumes`, и в `nginx.volumes`), затем `docker compose up -d`.

## Структура в админке (план): ЖК → подъезд → квартиры (потом: корпус)
Цель: контент-менеджеру удобно “проваливаться” по дереву (ЖК → подъезд) и в конце видеть список квартир. В некоторых ЖК позже может появиться уровень “корпус”.

Рекомендация (по‑битриксовому):
- ИБ `Проекты (ЖК)` — элементы = жилые комплексы (`kollekciya`, `vertical` и т.д.). Используем для страниц `/projects/<code>/` и для привязок (акции/новости/документы/ход строительства).
- ИБ `Квартиры` — элементы = квартиры, разделы = структура (дерево).

Пример дерева разделов в ИБ `Квартиры`:
```text
Квартиры (ИБ)
└── Коллекция (раздел, CODE=kollekciya)          ← 1-й уровень всегда ЖК
    ├── podezd-1 (раздел, CODE=podezd-1)
    │   └── (элементы: квартиры)
    └── podezd-2 (раздел, CODE=podezd-2)
        └── (элементы: квартиры)
```

URL квартир рекомендуем делать через ID (проще редиректы и переносы):
- сейчас: `/projects/kollekciya/podezd-1/flat-123/`
- потом (если появится корпус): `/projects/kollekciya/corpus-1/podezd-2/flat-123/`

Важно: уровни можно добавлять/убирать со временем. Чтобы “не ломать” структуру, фиксируем стабильные `CODE` для разделов (ЖК/корпус/подъезд), а квартиры идентифицируем в URL по `ID` (`flat-123`).

## Инфоблоки (план): Новости и Акции + будущие привязки
Заводим в админке ИБ `Новости` и ИБ `Акции` как самостоятельные сущности и сначала подключаем их на сайт через компоненты (без изменения вёрстки).

Привязки акций “на будущее” (чтобы не переделывать структуру позже):
- В ИБ `Акции` закладываем свойства (множественные):
  - `LINK_PROJECTS` — привязка к элементам ИБ `Проекты (ЖК)` (акция для одного/нескольких ЖК)
  - `LINK_FLATS` — привязка к элементам ИБ `Квартиры` (акция для одной/нескольких квартир)

Логику автоматического применения скидок (правила/приоритеты/пересечения) обсуждаем и внедряем отдельным этапом, когда станет понятен бизнес‑сценарий.
